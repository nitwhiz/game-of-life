window.onload=function(){function C(a){var c=a%b.gridSize;return{x:c,y:(a-c)/b.gridSize}}function u(){for(var a=0,c=b.gridSize*b.gridSize;a<c;a++)l[a]=0;q=0}function I(a){a=C(a);for(var c,d,e=[],f=-b.radius;f<=b.radius;f++)for(var g=-b.radius;g<=b.radius;g++)if(f*f+g*g<=b.radius*b.radius||1==b.radius&&(-1==f&&-1==g||1==f&&-1==g||-1==f&&1==g||1==f&&1==g))b.toroidal?(c=f+a.x>=b.gridSize?0:0>f+a.x?b.gridSize-1:f+a.x,d=g+a.y>=b.gridSize?0:0>g+a.y?b.gridSize-1:g+a.y,e.push(b.gridSize*d+c)):f+a.x<b.gridSize&&
0<=f+a.x&&g+a.y<b.gridSize&&0<=g+a.y&&e.push(b.gridSize*(g+a.y)+(f+a.x));return e}function D(){r=l.slice();l.forEach(function(a,c){p=0;I(c).forEach(function(a){a!=c&&1==l[a]&&p++});(0==a||2==a)&&p<=b.gmax&&p>=b.gmin?r[c]=1:1==a&&(p>b.overpop||p<b.loneliness)&&(r[c]=2)});l=r.slice();q++}function E(){d.clearRect(0,0,b.canvasSize,b.canvasSize);l.forEach(function(a,b){0<a&&(v=C(b),d.fillStyle="rgba(0, 0, 0, "+1/(a*a*a*a)+")",d.fillRect(v.x*e,v.y*e,e,e))});d.strokeStyle="#ddd";for(var a=e;a<b.canvasSize;a+=
e)d.beginPath(),d.moveTo(a,0),d.lineTo(a,b.canvasSize),d.stroke(),d.closePath();for(a=e;a<b.canvasSize;a+=e)d.beginPath(),d.moveTo(0,a),d.lineTo(b.canvasSize,a),d.stroke(),d.closePath()}function F(){G=setInterval(function(){E();b.paused||D();J.innerHTML=q},b.delay)}function w(){var a=parseInt(x.value);K.innerHTML=k.value;m.setAttribute("max",k.value);L.innerHTML=m.value;M.innerHTML=4*a*a+4*a-1;k.setAttribute("min",m.value);k.setAttribute("max",4*a*a+4*a-1);N.innerHTML=h.value;n.setAttribute("max",
h.value);O.innerHTML=n.value;P.innerHTML=4*a*a+4*a-1;h.setAttribute("min",n.value);h.setAttribute("max",4*a*a+4*a-1);var c;parseInt(m.value)>parseInt(k.value)&&(m.value=4*a*a+4*a-1);(c=parseInt(k.value))>=4*a*a+4*a?k.value=4*a*a+4*a-1:c<parseInt(m.value)&&(k.value=m.value);parseInt(n.value)>parseInt(h.value)&&(n.value=h.value);(c=parseInt(h.value))<parseInt(n.value)?h.value=n.value:c>=4*a*a+4*a&&(h.value=4*a*a+4*a-1);b.radius=Q.innerHTML=parseInt(x.value);b.loneliness=R.innerHTML=parseInt(m.value);
b.overpop=S.innerHTML=parseInt(k.value);b.gmin=T.innerHTML=parseInt(n.value);b.gmax=U.innerHTML=parseInt(h.value);b.delay=V.innerHTML=parseInt(y.value);b.toroidal=H.checked;b.gridSize!=(c=parseInt(t.value))&&(b.gridSize=W.innerHTML=c,e=b.canvasSize/b.gridSize,u())}var d=document.getElementById("screen").getContext("2d");(new Date).getTime();var G=-1,b={delay:100,paused:!0,toroidal:!1,radius:1,loneliness:2,overpop:3,gmin:3,gmax:3,gridSize:50,canvasSize:800},e=b.canvasSize/b.gridSize,l=[],v,r,p,q=0;
d.canvas.width=d.canvas.height=b.canvasSize;d.canvas.onmousedown=function(a){if(b.paused){var c=b.gridSize*Math.floor(a.offsetY/e)+Math.floor(a.offsetX/e);l[c]=a.ctrlKey?0:a.shiftKey?1:1==l[c]?0:1;q=0;E()}};var X=document.getElementById("pause"),z=document.getElementById("step"),A=document.getElementById("randGrid"),B=document.getElementById("clearGrid"),x=document.getElementById("rngRadius"),Q=document.getElementById("valRadius"),m=document.getElementById("rngLoneliness"),R=document.getElementById("valLoneliness"),
K=document.getElementById("lMaxLone"),k=document.getElementById("rngOverpop"),S=document.getElementById("valOverpop"),L=document.getElementById("lMinOverpop"),M=document.getElementById("lMaxOverpop"),n=document.getElementById("rngGMin"),T=document.getElementById("valGMin"),N=document.getElementById("lMaxGMin"),h=document.getElementById("rngGMax"),U=document.getElementById("valGMax"),O=document.getElementById("lMinGMax"),P=document.getElementById("lMaxGMax"),y=document.getElementById("rngDelay"),V=
document.getElementById("valDelay"),t=document.getElementById("rngGridSize"),W=document.getElementById("valGridSize"),H=document.getElementById("isToroidal"),J=document.getElementById("currGen");X.onclick=function(){b.paused=!b.paused;b.paused?(this.value="Resume",A.removeAttribute("disabled"),B.removeAttribute("disabled"),z.removeAttribute("disabled"),t.removeAttribute("disabled")):(this.value="Pause",A.setAttribute("disabled","yes"),B.setAttribute("disabled","yes"),z.setAttribute("disabled","yes"),
t.setAttribute("disabled","yes"))};A.onclick=function(){for(var a=0,c=b.gridSize*b.gridSize;a<c;a++)l[a]=Math.floor(Math.random()+.5);q=0};B.onclick=function(){u()};z.onclick=function(){D()};x.onmousemove=m.onmousemove=k.onmousemove=n.onmousemove=h.onmousemove=y.onmousemove=t.onmousemove=H.onchange=function(){w()};y.onchange=function(){clearInterval(G);F();w()};w();u();F()};